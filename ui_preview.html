<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EasySQL - AI 数据库助手</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Code Highlight -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/sql.min.js"></script>
    <!-- Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        .message-animation {
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .typing-dot {
            animation: typing 1.4s infinite ease-in-out both;
        }
        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        @keyframes typing {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }
    </style>
</head>
<body class="bg-slate-50 h-screen flex flex-col text-slate-800 font-sans">

    <!-- Top Navigation -->
    <nav class="bg-white border-b border-slate-200 h-16 flex items-center justify-between px-6 shadow-sm z-10">
        <div class="flex items-center gap-3">
            <div class="bg-indigo-600 p-2 rounded-lg text-white">
                <i data-lucide="database-zap" class="w-6 h-6"></i>
            </div>
            <h1 class="font-bold text-xl tracking-tight text-slate-900">EasySQL</h1>
            <span class="text-xs bg-indigo-100 text-indigo-700 px-2 py-0.5 rounded-full font-medium">v0.1.0</span>
        </div>
        
        <div class="flex items-center gap-4">
            <!-- Database Selector -->
            <div class="relative group">
                <button class="flex items-center gap-2 px-3 py-1.5 bg-slate-100 hover:bg-slate-200 rounded-md text-sm font-medium transition-colors">
                    <i data-lucide="database" class="w-4 h-4 text-slate-500"></i>
                    <span>medical_db</span>
                    <i data-lucide="chevron-down" class="w-3 h-3 text-slate-400"></i>
                </button>
                <!-- Dropdown (Hidden) -->
                <div class="absolute right-0 top-full mt-1 w-48 bg-white rounded-lg shadow-lg border border-slate-100 hidden group-hover:block p-1">
                    <div class="px-3 py-2 text-xs text-slate-400 uppercase font-semibold">选择数据库</div>
                    <button class="w-full text-left px-3 py-2 text-sm text-indigo-600 bg-indigo-50 rounded-md mb-1 flex items-center justify-between">
                        medical_db <i data-lucide="check" class="w-3 h-3"></i>
                    </button>
                    <button class="w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-slate-50 rounded-md">
                        ecommerce_db
                    </button>
                    <button class="w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-slate-50 rounded-md">
                        hr_system
                    </button>
                </div>
            </div>

            <div class="h-6 w-px bg-slate-200"></div>

            <button class="p-2 text-slate-500 hover:bg-slate-100 rounded-full transition-colors relative" title="设置">
                <i data-lucide="settings" class="w-5 h-5"></i>
            </button>
            <button class="p-2 text-slate-500 hover:bg-slate-100 rounded-full transition-colors" title="Schema 浏览器">
                <i data-lucide="table-2" class="w-5 h-5"></i>
            </button>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="flex-1 flex overflow-hidden">
        
        <!-- Sidebar: History & Schema (Collapsible) -->
        <aside class="w-64 bg-slate-50 border-r border-slate-200 flex flex-col hidden md:flex">
            <div class="p-4 border-b border-slate-200 flex items-center justify-between">
                <h2 class="text-xs font-semibold text-slate-500 uppercase tracking-wider">历史会话</h2>
                <button class="text-slate-400 hover:text-indigo-600">
                    <i data-lucide="plus-circle" class="w-4 h-4"></i>
                </button>
            </div>
            
            <div class="flex-1 overflow-y-auto p-3 space-y-2">
                <!-- History Item (Active) -->
                <button class="w-full text-left p-3 rounded-lg bg-white border border-slate-200 shadow-sm group hover:border-indigo-300 transition-all">
                    <div class="text-sm font-medium text-slate-800 truncate">门诊挂号量统计</div>
                    <div class="text-xs text-slate-400 mt-1 flex items-center justify-between">
                        <span>2 分钟前</span>
                        <i data-lucide="chevron-right" class="w-3 h-3 opacity-0 group-hover:opacity-100 text-indigo-500 transition-opacity"></i>
                    </div>
                </button>

                <!-- History Item -->
                <button class="w-full text-left p-3 rounded-lg hover:bg-white hover:shadow-sm border border-transparent hover:border-slate-200 transition-all">
                    <div class="text-sm font-medium text-slate-600 truncate">内科医生排班查询</div>
                    <div class="text-xs text-slate-400 mt-1">昨天 15:30</div>
                </button>
                
                <!-- History Item -->
                <button class="w-full text-left p-3 rounded-lg hover:bg-white hover:shadow-sm border border-transparent hover:border-slate-200 transition-all">
                    <div class="text-sm font-medium text-slate-600 truncate">药品库存预警分析</div>
                    <div class="text-xs text-slate-400 mt-1">昨天 10:12</div>
                </button>
            </div>

            <!-- Schema Snapshot (Mini) -->
            <div class="p-4 border-t border-slate-200 bg-slate-100">
                <div class="flex items-center gap-2 mb-2">
                    <i data-lucide="network" class="w-4 h-4 text-indigo-500"></i>
                    <span class="text-xs font-semibold text-slate-600">当前 Schema 概览</span>
                </div>
                <div class="grid grid-cols-2 gap-2">
                    <div class="bg-white p-2 rounded border border-slate-200 text-center">
                        <div class="text-lg font-bold text-slate-800">12</div>
                        <div class="text-[10px] text-slate-500">表</div>
                    </div>
                    <div class="bg-white p-2 rounded border border-slate-200 text-center">
                        <div class="text-lg font-bold text-slate-800">85</div>
                        <div class="text-[10px] text-slate-500">字段</div>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Chat Area -->
        <main class="flex-1 flex flex-col bg-white relative">
            
            <!-- Messages Container -->
            <div class="flex-1 overflow-y-auto p-6 space-y-6" id="chat-container">
                
                <!-- Welcome Message -->
                <div class="flex gap-4 max-w-4xl mx-auto message-animation">
                    <div class="w-8 h-8 rounded-full bg-indigo-100 flex items-center justify-center flex-shrink-0 mt-1">
                        <i data-lucide="bot" class="w-5 h-5 text-indigo-600"></i>
                    </div>
                    <div class="space-y-1">
                        <div class="font-medium text-sm text-slate-500">EasySQL Agent</div>
                        <div class="bg-slate-50 p-4 rounded-2xl rounded-tl-none border border-slate-100 text-sm leading-relaxed shadow-sm">
                            <p>你好！我是你的数据库助手。你可以用自然语言询问数据，我会帮你生成并执行 SQL。</p>
                            <p class="mt-2 text-slate-500">试着问我：</p>
                            <div class="mt-2 flex flex-wrap gap-2">
                                <button class="px-3 py-1 bg-white border border-slate-200 rounded-full text-xs hover:border-indigo-300 hover:text-indigo-600 transition-colors">
                                    查询今天挂号量前十的科室
                                </button>
                                <button class="px-3 py-1 bg-white border border-slate-200 rounded-full text-xs hover:border-indigo-300 hover:text-indigo-600 transition-colors">
                                    统计各科室医生的平均年龄
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- User Message -->
                <div class="flex gap-4 max-w-4xl mx-auto flex-row-reverse message-animation">
                    <div class="w-8 h-8 rounded-full bg-slate-200 flex items-center justify-center flex-shrink-0 mt-1">
                        <i data-lucide="user" class="w-5 h-5 text-slate-600"></i>
                    </div>
                    <div class="space-y-1 text-right">
                        <div class="font-medium text-sm text-slate-500">你</div>
                        <div class="bg-indigo-600 text-white p-4 rounded-2xl rounded-tr-none text-sm leading-relaxed shadow-md text-left inline-block">
                            查询今天门诊挂号量最多的前10个科室
                        </div>
                    </div>
                </div>

                <!-- Agent Clarification (HITL Example) -->
                <!-- Hidden for this demo state, but structure is here -->

                <!-- Agent Response (SQL Result) -->
                <div class="flex gap-4 max-w-4xl mx-auto message-animation">
                    <div class="w-8 h-8 rounded-full bg-indigo-100 flex items-center justify-center flex-shrink-0 mt-1">
                        <i data-lucide="bot" class="w-5 h-5 text-indigo-600"></i>
                    </div>
                    <div class="space-y-2 w-full max-w-3xl">
                        <div class="font-medium text-sm text-slate-500 flex items-center gap-2">
                            EasySQL Agent
                            <span class="text-[10px] bg-green-100 text-green-700 px-1.5 py-0.5 rounded flex items-center gap-1">
                                <i data-lucide="check-circle-2" class="w-3 h-3"></i> 验证通过
                            </span>
                        </div>
                        
                        <!-- Thinking Process (Collapsible) -->
                        <details class="group">
                            <summary class="list-none cursor-pointer">
                                <div class="flex items-center gap-2 text-xs text-slate-400 hover:text-slate-600 transition-colors mb-2">
                                    <i data-lucide="brain-circuit" class="w-3 h-3"></i>
                                    <span>思考过程: 检索到 3 张相关表，分析意图为聚合排序...</span>
                                    <i data-lucide="chevron-down" class="w-3 h-3 group-open:rotate-180 transition-transform"></i>
                                </div>
                            </summary>
                            <div class="bg-slate-50 p-3 rounded-lg border border-slate-100 text-xs text-slate-500 mb-2 space-y-1">
                                <div class="flex items-center gap-2">
                                    <i data-lucide="search" class="w-3 h-3 text-blue-500"></i>
                                    <span>检索表: `outpatient_registration`, `department`</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <i data-lucide="git-merge" class="w-3 h-3 text-purple-500"></i>
                                    <span>连接路径: `outpatient_registration.dept_id` -> `department.dept_id`</span>
                                </div>
                            </div>
                        </details>

                        <!-- SQL Code Block -->
                        <div class="border border-slate-200 rounded-lg overflow-hidden shadow-sm bg-[#282c34]">
                            <div class="flex items-center justify-between px-4 py-2 bg-[#21252b] border-b border-slate-700">
                                <span class="text-xs text-slate-400 font-mono">MySQL Query</span>
                                <div class="flex items-center gap-2">
                                    <button class="text-slate-400 hover:text-white transition-colors" title="复制">
                                        <i data-lucide="copy" class="w-3 h-3"></i>
                                    </button>
                                    <button class="text-slate-400 hover:text-white transition-colors" title="解释">
                                        <i data-lucide="message-square-more" class="w-3 h-3"></i>
                                    </button>
                                </div>
                            </div>
                            <pre class="m-0 p-0"><code class="language-sql text-sm p-4 block overflow-x-auto">SELECT 
    d.dept_name, 
    COUNT(*) as visit_count
FROM outpatient_registration r
JOIN department d ON r.dept_id = d.dept_id
WHERE DATE(r.reg_time) = CURDATE()
GROUP BY d.dept_id, d.dept_name
ORDER BY visit_count DESC
LIMIT 10;</code></pre>
                        </div>

                        <!-- Execution Result Preview (Table) -->
                        <div class="mt-2 border border-slate-200 rounded-lg overflow-hidden bg-white shadow-sm">
                            <div class="px-4 py-2 bg-slate-50 border-b border-slate-200 flex items-center justify-between">
                                <span class="text-xs font-semibold text-slate-600">执行结果 (10 rows, 0.05s)</span>
                                <button class="text-indigo-600 hover:text-indigo-700 text-xs font-medium flex items-center gap-1">
                                    <i data-lucide="download" class="w-3 h-3"></i> 导出 CSV
                                </button>
                            </div>
                            <div class="overflow-x-auto">
                                <table class="w-full text-sm text-left">
                                    <thead class="text-xs text-slate-500 uppercase bg-slate-50">
                                        <tr>
                                            <th class="px-4 py-3 font-medium">dept_name</th>
                                            <th class="px-4 py-3 font-medium text-right">visit_count</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-slate-100">
                                        <tr class="hover:bg-slate-50">
                                            <td class="px-4 py-2.5">心血管内科</td>
                                            <td class="px-4 py-2.5 text-right font-mono text-slate-600">145</td>
                                        </tr>
                                        <tr class="hover:bg-slate-50">
                                            <td class="px-4 py-2.5">呼吸内科</td>
                                            <td class="px-4 py-2.5 text-right font-mono text-slate-600">132</td>
                                        </tr>
                                        <tr class="hover:bg-slate-50">
                                            <td class="px-4 py-2.5">儿科门诊</td>
                                            <td class="px-4 py-2.5 text-right font-mono text-slate-600">98</td>
                                        </tr>
                                        <tr class="bg-slate-50/50">
                                            <td class="px-4 py-2 text-xs text-slate-400 italic text-center" colspan="2">... 剩余 7 行 ...</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Feedback Actions -->
                        <div class="flex items-center gap-2 mt-2">
                            <button class="flex items-center gap-1 px-2 py-1 rounded hover:bg-slate-100 text-xs text-slate-500 transition-colors">
                                <i data-lucide="thumbs-up" class="w-3 h-3"></i> 有帮助
                            </button>
                            <button class="flex items-center gap-1 px-2 py-1 rounded hover:bg-slate-100 text-xs text-slate-500 transition-colors">
                                <i data-lucide="thumbs-down" class="w-3 h-3"></i> 报错
                            </button>
                            <button class="flex items-center gap-1 px-2 py-1 rounded hover:bg-slate-100 text-xs text-slate-500 transition-colors ml-auto">
                                <i data-lucide="refresh-cw" class="w-3 h-3"></i> 重新生成
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Example: Clarification Request -->
                <div class="flex gap-4 max-w-4xl mx-auto message-animation">
                    <div class="w-8 h-8 rounded-full bg-indigo-100 flex items-center justify-center flex-shrink-0 mt-1">
                        <i data-lucide="bot" class="w-5 h-5 text-indigo-600"></i>
                    </div>
                    <div class="space-y-2 w-full max-w-2xl">
                        <div class="bg-amber-50 border border-amber-200 rounded-2xl rounded-tl-none p-4 shadow-sm">
                            <div class="flex items-start gap-3">
                                <i data-lucide="help-circle" class="w-5 h-5 text-amber-500 mt-0.5 flex-shrink-0"></i>
                                <div>
                                    <h3 class="text-sm font-semibold text-amber-800 mb-1">需要澄清</h3>
                                    <p class="text-sm text-amber-900 mb-3">您想查询的"最近"是指什么时间范围？</p>
                                    <div class="flex flex-wrap gap-2">
                                        <button class="px-3 py-1.5 bg-white border border-amber-200 rounded-md text-xs font-medium text-amber-800 hover:bg-amber-100 hover:border-amber-300 transition-colors shadow-sm">
                                            最近 7 天
                                        </button>
                                        <button class="px-3 py-1.5 bg-white border border-amber-200 rounded-md text-xs font-medium text-amber-800 hover:bg-amber-100 hover:border-amber-300 transition-colors shadow-sm">
                                            最近 30 天
                                        </button>
                                        <button class="px-3 py-1.5 bg-white border border-amber-200 rounded-md text-xs font-medium text-amber-800 hover:bg-amber-100 hover:border-amber-300 transition-colors shadow-sm">
                                            本月至今
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Spacer for bottom input -->
                <div class="h-20"></div>
            </div>

            <!-- Input Area -->
            <div class="absolute bottom-0 left-0 right-0 bg-white border-t border-slate-200 p-4 pb-6">
                <div class="max-w-4xl mx-auto relative">
                    <!-- Loading State (Hidden by default) -->
                    <!-- 
                    <div class="absolute -top-10 left-1/2 -translate-x-1/2 bg-indigo-600 text-white text-xs px-3 py-1.5 rounded-full shadow-lg flex items-center gap-2 animate-bounce">
                        <i data-lucide="loader-2" class="w-3 h-3 animate-spin"></i>
                        正在思考...
                    </div>
                    -->

                    <div class="relative flex items-end gap-2 bg-slate-50 border border-slate-300 rounded-xl p-2 shadow-sm focus-within:ring-2 focus-within:ring-indigo-500/20 focus-within:border-indigo-500 transition-all">
                        <button class="p-2 text-slate-400 hover:text-indigo-600 rounded-lg hover:bg-slate-200 transition-colors" title="清除上下文">
                            <i data-lucide="eraser" class="w-5 h-5"></i>
                        </button>
                        
                        <textarea 
                            class="w-full bg-transparent border-none focus:ring-0 resize-none max-h-32 py-2 text-sm text-slate-800 placeholder:text-slate-400"
                            placeholder="输入您的问题，例如：统计上个月各科室的收入情况..."
                            rows="1"
                            oninput="this.style.height = ''; this.style.height = this.scrollHeight + 'px'"
                        ></textarea>
                        
                        <button class="p-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg shadow-sm transition-all transform active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed">
                            <i data-lucide="send-horizontal" class="w-5 h-5"></i>
                        </button>
                    </div>
                    
                    <div class="text-[10px] text-center text-slate-400 mt-2">
                        EasySQL 可能生成错误的 SQL，请并在生产环境中仔细核对。
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Initialize Icons
        lucide.createIcons();
        
        // Initialize Syntax Highlighting
        hljs.highlightAll();
    </script>
</body>
</html>